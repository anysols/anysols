<link href="/views/styles/base.css" rel="stylesheet">
<link href="/views/styles/menu.css" rel="stylesheet">
<script>
  window.MENU = <%- JSON.stringify(menu) %>;

  function onLoadFrame(obj, resize) {
    if (window.history.pushState) {
      let frameUrl = new URL(obj.contentWindow.location.href);
      let newUrl = window.location.protocol + '//' + window.location.host + window.location.pathname + '?url=' +
          frameUrl.pathname;
      window.history.pushState({path: newUrl}, '', newUrl);
    }
    $('#main-iframe-loading').addClass('d-none');
    $('#main-iframe').removeClass('d-none');
    if (resize)
      obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
  }

  $(document).ready(function() {
    $('.shortcuts-tree').on('click', function() {
      $(this).parent().toggleClass('active');
      $(this).find('.svg-inline--fa').toggleClass('fa-chevron-right fa-chevron-down');
    });
    $('.link a').on('click', function() {
      $('.link').removeClass('active');
      $(this).closest('.link').addClass('active');
      setIframeUrl($(this).attr('data-url'));
    });
    $('.context-header').on('click', function() {
      setIframeUrl('/menu/' + window.MENU.id + '/home');
    });
  });

  function setIframeUrl(url) {
    $('#main-iframe').attr('src', url);
  }
</script>

<%- partial('../partials/header-navigation') %>

<main role="main">
    <div class="nav-sidebar bg-light">
        <div class="nav-sidebar-inner-scroll">
            <div class="context-header">
                <a href="javascript:void(0)">
                    <div class="avatar-container">
                        <div class="avatar  avatar-tile"><%= menu.label[0] %></div>
                    </div>
                    <div class="sidebar-context-title">
                        <%= menu.label %>
                    </div>
                </a>
            </div>
            <ul class="sidebar-top-level-items">
                <%- partial('../partials/nav-tree', {modules: modules}) %>
            </ul>

        </div>
    </div>
    <div class="container-fluid pt-3" id="main-iframe-loading">
        loading
    </div>
    <%
    if (!url) {
        url = "/menu/" + menu.id + "/home";
    }
    %>
    <iframe id="main-iframe" class="d-none" src="<%= url %>" frameBorder="0" scrolling="yes"
            onload="onLoadFrame(this);"></iframe>
</main>

