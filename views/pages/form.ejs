<div class="container pt-3">
    <h1 class="h5"><%= table.label %></h1>
    <form id="view-form" class="needs-validation" novalidate>
        <% cols.forEach(function(col){ if(col != 'id'){ %>
        <div class="form-group row">
            <label for="inputEmail3" class="col-sm-2 col-form-label"><%= col %></label>
            <div class="col-sm-10">
                <input type="text" required class="form-control" id="<%= col %>" name="<%= col %>"
                       placeholder="<%= col %>">
                <div class="invalid-feedback">
                    Please provide a <%= col %>.
                </div>
            </div>
        </div>
        <% }}); %>
        <div class="form-group row">
            <div class="col-sm-10">
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </div>
    </form>

    <script>
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                let form = document.getElementById('view-form');
                form.addEventListener('submit', function (event) {
                    if (form.checkValidity() === true) {
                        let formObj = {};
                        let inputs = $(form).serializeArray();
                        $.each(inputs, function (i, input) {
                            formObj[input.name] = input.value;
                        });
                        $.post("/p/<%= table.name %>/new", formObj)
                            .done(function (data) {
                                window.location.reload();
                            }, function () {
                                alert('something went wrong check you fields.')
                            });
                    }
                    event.preventDefault();
                    event.stopPropagation();
                }, false);
            }, false);
        })();
    </script>
</div>
